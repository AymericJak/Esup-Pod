{% load static i18n custom_tags %}{% spaceless %}
{% get_current_language as LANGUAGE_CODE %}
{% get_available_languages as LANGUAGES %}
{% get_language_info_list for LANGUAGES as languages %}
{% load thumbnail %}

<div class="container pod-container" id="nav-mainbar">
  <div class="pod-brand">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" title="{% trans 'Toggle navigation' %}">
      <i class="bi bi-list" aria-hidden="true"></i>
    </button>
    <a class="navbar-brand mr-0 mr-sm-1" href="/">
      <img src="{% static LOGO_SITE %}" height="48" alt="" loading="lazy"/><strong>{{ TITLE_SITE }}</strong>
    </a>
  </div>

  <div class="collapse navbar-collapse navbar-items-pod" id="navbarSupportedContent">
    <ul class="navbar-nav mx-auto">
      {% if HIDE_CHANNEL_TAB == False %}
      <li class="nav-item" id="nav-channels">
        <button class="nav-link" data-bs-toggle="modal" data-bs-target=".chaines-modal">
          <i class="bi bi-youtube"></i> {% trans "Channels" %}</button>
      </li>
      {% for add_channel_tab in ADD_CHANNELS_TAB %}
        <li class="nav-item add-nav-channels" >
          <button class="nav-link" data-bs-toggle="modal" data-bs-target=".chaines-modal-{{add_channel_tab.id}}"><i class="bi bi-youtube"></i> {{ add_channel_tab.name }}</button>
        </li>
      {% endfor %}

      {% endif %}
      {% if HIDE_USER_TAB == False and user.is_authenticated %}
        <li class="nav-item" id="nav-users">
          <button class="nav-link" data-bs-toggle="modal" data-bs-target=".users-modal"><i class="bi bi-people" aria-hidden="true" class="pod-nav-link-icon d-lg-none d-xl-inline"></i> {% trans "Users"%}</button>
        </li>
      {% endif %}
      {% if HIDE_TYPES_TAB == False %}
        <li class="nav-item" id="nav-types">
          <button class="nav-link" data-bs-toggle="modal" data-bs-target=".types-modal">  <i class="bi bi-tv"></i> {% trans "Types"%}</button>
        </li>
      {% endif %}
      {% if "live" in THIRD_PARTY_APPS %}
        <li class="nav-item" id="nav-live">
          <a class="nav-link" href="{% url 'live:lives'%}"><i class="bi bi-broadcast"></i> {% trans "Lives"%}</a>
        </li>
      {% endif %}
      {% if HIDE_LANGUAGE_SELECTOR == False %}
        <li class="nav-item d-flex d-block d-lg-none langs pt-2 mt-2 justify-content-around" id="nav-languagechoice">
          <div class="active alert m-0">{{LANGUAGE_CODE}}</div>
          {% for language in languages %}
            {% if language.code != LANGUAGE_CODE %}
              <form class="form form-inline p-0 m-0" action="/i18n/setlang/" method="post">
                {% csrf_token %}
                <input name="language" value="{{ language.code }}" type="hidden">
                <input value="{{ language.name_local }} ({{ language.code }})" class="btn btn-light my-2 mr-sm-2" type="submit">
              </form>
            {% endif %}
          {% endfor %}
        </li>
      {% endif %}
    </ul>
  </div>
  <form class="form-inline my-2 my-lg-0 flex-2" action="{% url "search_videos" %}" id="nav-search">
    <label for="s" class="d-lg-none">
      <i class="bi bi-search"></i> <span class="visually-hidden">{% trans "Search" %}</span>
    </label>
    <input class="form-control mr-sm-2" id="s" placeholder="{% trans 'Search' %}" aria-label="{% trans 'Search' %}" type="search" name="q" >
  </form>

  <ul class="navbar-nav flex-row align-items-center flex-grow-1 justify-content-between" id="nav-useraction">
    <li class="nav-item mr-2" id="nav-addvideo">
      {%if MAINTENANCE_MODE%}
        <span class="badge badge-danger">{{MAINTENANCE_REASON}} <br/><i width=16 height=16 class="bi bi-exclamation-triangle"></i> {%trans "Some features are unavailable" %}</span>
      {%else%}
          <a class="nav-link pl-2 pr-2" href="{% url 'video_add' %}"><i class="bi bi-plus-square"></i>&nbsp;<span class="d-none d-md-inline-block">{% trans "Add a video" %}</span></a>
      {%endif%}
    </li>
    {% if user.is_authenticated %}
      <li class="nav-item dropdown login mr-2" id="nav-usermenu">
        <button class="{% if not request.user.owner.userpicture  %}initials btn btn-primary{% else %} nav-link{% endif %} pl-2 pr-2 dropdown-toggle d-flex justify-content-center align-items-center" id="navbarDropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          {% if request.user.owner.userpicture  %}
            <img src="{{user.owner.userpicture.file.url}}" class="userpicture rounded" alt="{{user.get_full_name}}" loading="lazy">
          {% endif %}
          <span class="userinitial" {% if request.user.owner.userpicture  %}style="display:none"{% endif %}>
            {% if user.first_name != '' and user.last_name != '' %}{{ user.first_name|first|upper }}{{ user.last_name|first|upper }}{% else %}{{ user.username|slice:":2"|upper}}{% endif %}
          </span>
        </button>
        <div class="dropdown-menu dropdown-menu-right" >
          <h6 class="dropdown-header">{% if user.get_full_name != '' %}{{ user.get_full_name }}{% else %}{{ user.username }}{% endif %}</h6>
          <div class="dropdown-divider"></div>
          {% if request.user.is_superuser or user.owner.is_manager %}
            <a class="dropdown-item pod-dropdown-item" href="{% url 'admin:index' %}"><i class="bi bi-cpu pod-nav-link-icon d-lg-none d-xl-inline mx-1"></i>Administration</a>
          {% endif %}
          {% if request.user.is_staff or request.user.is_superuser %}
            <button class="dropdown-item pod-dropdown-item get_form_userpicture" data-url="{% url "userpicture" %}">
              <i class="bi bi-card-image pod-nav-link-icon d-lg-none d-xl-inline mx-1"></i>{% if request.user.owner.userpicture  %}{% trans 'Change your picture' %}{% else %}{% trans 'Add your picture' %}{% endif %}
            </button>
          {% endif %}
          <a class="dropdown-item pod-dropdown-item" href="{% url 'my_videos' %}"><i class="bi bi-film pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans 'My videos' %}</a>
          {% if USE_OPENCAST_STUDIO %}
          <a class="dropdown-item pod-dropdown-item" href="{% url 'recorder:studio_pod'%}"><i class="bi bi-camera-video pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans "Video Record" %}</a>
          {% endif %}
          {% if request.user.owners_channels.all %}
            <a class="dropdown-item pod-dropdown-item" href="{% url 'my_channels' %}"><i class="bi bi-youtube pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans 'My channels' %}</a>
          {% endif %}
          <a class="dropdown-item pod-dropdown-item" href="{% url 'my_playlists' %}"><i class="bi bi-cast pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans 'My playlists' %}</a>
          {% if request.user.is_staff and USE_PODFILE %}
            <a class="dropdown-item pod-dropdown-item" href="{% url 'podfile:home' %}"><i class="bi bi-folder pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans 'My files' %}</a>
          {% endif %}
          {% if request.user.is_staff and ALLOW_MANUAL_RECORDING_CLAIMING %}
            <a class="dropdown-item pod-dropdown-item" href="{% url 'claim_record' %}"><i class="bi bi-share pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans 'Claim a record' %}</a>
          {% endif %}
          {% if request.user.is_staff and USE_BBB %}
            <a class="dropdown-item pod-dropdown-item" href="{% url 'bbb:list_meeting' %}"><i class="bi bi-square pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans 'My BigBlueButton records' %}</a>
            {% if USE_BBB_LIVE %}
              <a class="dropdown-item pod-dropdown-item" href="{% url 'bbb:live_list_meeting' %}"><i class="bi bi-lightning-charge pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans 'Perform a BigBlueButton live' %}</a>
            {% endif %}
          {% endif %}
          <!-- <a class="dropdown-item pod-dropdown-item" href="#">Gestion de mon compte</a> -->
          <div class="dropdown-divider"></div>
          <a class="dropdown-item pod-dropdown-item" href="{% url 'authentication_logout' %}">
            <i class="bi bi-box-arrow-right pod-nav-link-icon d-lg-none d-xl-inline mx-1" aria-hidden="true"></i>{% trans 'Log out' %}</a>
        </div>
      </li>
    {% else %}{# user not authenticated #}
      {% get_setting "LOGIN_URL" "/authentication_login/" as LOGIN_URL %}
      {% if request.path != LOGIN_URL %}
        <li class="nav-item dropdown login mr-2" id="nav-authentication">
          {% get_url_referrer request as url_referrer %}
          <a class="btn btn-primary pl-2 pr-2 d-flex justify-content-center" href="{% url 'authentication_login' %}{{ url_referrer }}" >
            {% trans 'Log in' %}
          </a>
        </li>
      {% endif %}
    {% endif %}
    {% if HIDE_LANGUAGE_SELECTOR == False %}
        <li class="nav-item d-none d-lg-block" id="nav-languagechoicelg">
          <div class="btn-group"><button type="button" class="btn btn-lang btn-lang-active my-2 mr-sm-2 dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              {{LANGUAGE_CODE}}
            </button>
            <div class="dropdown-menu dropdown-menu-right p-0 m-0">
              {% for language in languages %}
                {% if language.code != LANGUAGE_CODE %}
                  <form action="/i18n/setlang/" method="post">
                    {% csrf_token %}
                    <input name="language" value="{{ language.code }}" type="hidden">
                    <input value="{{ language.name_local }} ({{ language.code }})" class="dropdown-item pod-dropdown-item" type="submit">
                  </form>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </li>
      {% endif %}
    </ul>
    {% if DARKMODE_ENABLED == True or DYSLEXIAMODE_ENABLED == True %}
      <ul class="navbar-nav" id="nav-theme-switch">
        {% if DARKMODE_ENABLED == True %}
          <li class="nav-item mx-1" id="theme-switch-wrapper" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="bottom" title="{% trans 'Dark mode' %}">
            <label class="theme-switch" for="checkbox-darkmode">
              <span class="visually-hidden">{% trans 'Dark mode' %}</span>
              <input type="checkbox" id="checkbox-darkmode" />
              <span class="slider">
                <i class="bi bi-sun"></i>
                <i class="bi bi-moon"></i>
              </span>
            </label>
          </li>
        {% endif %}{% if DYSLEXIAMODE_ENABLED == True %}
          <li class="nav-item mx-1" id="dyslexia-switch-wrapper" aria-hidden="true" data-bs-toggle="tooltip" data-bs-placement="bottom" title="{% trans 'Dyslexia mode' %}">
            <label class="dyslexia-switch" for="checkbox-dyslexia">
              <span class="visually-hidden">{% trans 'Dyslexia mode' %}</span>
              <input type="checkbox" id="checkbox-dyslexia" />
              <span class="slider">
                 <i class="bi bi-eye-slash"></i>
                 <i class="bi bi-eye"></i>
              </span>
            </label>
          </li>
        {% endif %}
      </ul>
    {% endif %}

</div> <!-- FIN Container -->
{% endspaceless %}
