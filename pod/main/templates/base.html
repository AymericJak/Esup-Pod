{% load staticfiles %}
{% load i18n %}
<!doctype html>
<html lang="fr">
	<head>
	    <!-- Required meta tags -->
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
	    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	    <meta name="description" content="">
	    <meta name="author" content="">

        {% if FAVICON %}
	    <link rel="icon" href="{% static FAVICON %}">
        {% endif %}
	    <!-- Bootstrap CSS -->
	    <link rel="stylesheet" href="{% static 'bootstrap-4/css/bootstrap.min.css' %}" crossorigin="anonymous">

	    <!-- octicons -->
	    <link rel="stylesheet" href="{% static 'css/lillePod.css' %}" media="screen" title="no title">
        {% if CSS_OVERRIDE %}
        <link rel="stylesheet" href="{% static CSS_OVERRIDE %}" media="screen" title="no title">
        {% endif %}
        <!-- Javascript -->
        <script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
        <script src="{% static 'bootstrap-4/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'js/js.cookie.js' %}"></script>
	    <title>{{ TITLE_SITE }} - {% block page_title %}{% endblock %}</title>

	    {% block page_extra_head %}{% endblock %}
	</head>
	<body>
		<!-- barre nav-->
		<nav class="navbar navbar-expand-lg fixed-top navbar-light bg-light m-0 p-0">
		{% include 'navbar.html' %}
		</nav><!-- fin barre nav-->
		{% include 'navbar_collapse.html' %}
		{% block content %}
		<div class="container">
			<main role="main" class="mt-3">
		        <nav aria-label="breadcrumb" class="breadcrumb d-flex justify-content-between p-0">
		          <ol class="breadcrumb p-1 pl-4 mb-0">
		          	{% block breadcrumbs %}
		                <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
					{% endblock breadcrumbs %}
		          </ol>
		          <div class="p-0">
                    {% block collapse_page_aside %}
		            <a class="btn btn-primary btn-sm collapseAside" data-toggle="collapse" href="#collapseAside" role="button" aria-expanded="false" aria-controls="collapseAside" >
		              <i data-feather="corner-left-up"></i><i data-feather="menu"></i>
		            </a>
                    {% endblock collapse_page_aside %}
		          </div>
		        </nav>
		        <div class="row">
		        	<div class="col order-12 order-md-1">
						<!-- contenu page statique -->
						<div class="jumbotron">
							{% block page_content %}
								<p> Contenu block page_content </p>
							{% endblock page_content %}
						</div>
						<!-- fin contenu page statique -->
						{% include "videos/last_videos.html" %}
		        	</div> <!-- fin col order-12 order-md-1 -->
		        	<aside class="collapse col-12 col-md-3 order-1 order-md-12 mb-3" id="collapseAside">
                        {% block page_aside %}
					       {% include 'aside.html'%}
                        {% endblock page_aside %}
					</aside>
		        </div> <!-- fin row -->
		    </main>
		</div> <!-- fin container -->
		{% endblock content %}
		<footer class="text-muted bg-dark pt-2">
		{% include 'footer.html' %}
		</footer>
        
        {% if messages %}
        <div id="base-message-alert">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endfor %}
        </div>
        {% endif %}
        <!-- JS -->
        <script>
        var showalert = function(message,alerttype) {
            $('body').append('<div id="formalertdiv" class="alert ' +  alerttype + ' alert-dismissible fade show"  role="alert">'+message+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
            setTimeout(function() { $("#formalertdiv").remove(); }, 5000);
        };
        </script>
		<script>
		var listUser = {{LISTOWNER|safe}};

		$('#ownerboxnavbar').keyup(function() {
			if($(this).val() && $(this).val().length > 2) {
				var valThis = $(this).val().toLowerCase();
				var letter = valThis.charAt(0);
				var nbuser = listUser[letter].length;
				$("#accordion").html("");
				for(i=0; i<nbuser; i++) {
					var lastname = listUser[letter][i]["last_name"].toLowerCase();
					if(lastname.indexOf(valThis) != -1) $("#accordion").append('<li><a href="{% url 'videos' %}?owner='+listUser[letter][i]["username"]+'" title="">'+listUser[letter][i]["first_name"]+' '+listUser[letter][i]["last_name"]+' ('+listUser[letter][i]["username"]+')</a></li>');
				}
			} else {
				$("#accordion").html("");
			}
		});
		$(".showUser").on('click', function() {
			var letter = $(this).attr("data-target").toLowerCase();
			var nbuser = listUser[letter].length;
			$("#accordion").html("");
			for(i=0; i<nbuser; i++) {
				$("#accordion").append('<li><a href="{% url 'videos' %}?owner='+listUser[letter][i]["username"]+'" title="">'+listUser[letter][i]["first_name"]+' '+listUser[letter][i]["last_name"]+' ('+listUser[letter][i]["username"]+')</a></li>');
			}
		})

        $(document).ready(function () {
            //when a group is shown, save it as the active accordion group
            $("#collapseAside").on('shown.bs.collapse', function () {
                Cookies.set('activeCollapseAside', "open");
                $(".collapseAside").html('<i data-feather="corner-left-up"></i><i data-feather="menu"></i>');
                feather.replace({ class: 'align-bottom'});
            });
            $("#collapseAside").on('hidden.bs.collapse', function () {
                Cookies.set('activeCollapseAside', "close");
                $(".collapseAside").html('<i data-feather="corner-left-down"></i><i data-feather="menu"></i>');
                feather.replace({ class: 'align-bottom'});
            });
            var last = Cookies.get('activeCollapseAside');
            //alert('last '+last);
            if (last != null && last=="close") {
                //show the account_last visible group
                $("#collapseAside").addClass("hide");
                $(".collapseAside").html('<i data-feather="corner-left-down"></i><i data-feather="menu"></i>');
                feather.replace({ class: 'align-bottom'});
            } else {
                $("#collapseAside").addClass("show");
                $(".collapseAside").html('<i data-feather="corner-left-up"></i><i data-feather="menu"></i>');
                feather.replace({ class: 'align-bottom'});
            } 
            TriggerAlertClose();
        });

        function TriggerAlertClose() {
            window.setTimeout(function () {
                $(".alert").fadeTo(1000, 0).slideUp(1000, function () {
                    $(this).remove();
                });
            }, 5000);
        }
        /*** USER PICTURE ***/

        $(document).on("click", ".get_form_userpicture",function() {
            jqxhr = $.get(
                "{% url "userpicture" %}"
            );
            jqxhr.done(function(data){
                $('body').append(data);
                $('#userpictureModal').modal('show');
            });
            jqxhr.fail(function($xhr) {
                var data = $xhr.status+ " : " +$xhr.statusText;
                showalert("{% trans 'Error during recording.' %} " + "("+data+")<br/>"+"{% trans 'No data could be stored.' %}", "alert-danger");
            });
        });
        $(document).on('hidden.bs.modal', '#userpictureModal', function (e) {
          $('#userpictureModal').remove();
        });
        $(document).on("submit", "#userpicture_form", function (e) {
            e.preventDefault();
            var jqxhr= '';
            var data_form = $( "#userpicture_form" ).serializeArray();
            jqxhr = $.post(
                $( "#userpicture_form" ).attr("action"),
                data_form
            );
            jqxhr.done(function(data){
                $( "#userpicture_form" ).html($(data).find("#userpicture_form").html());
                if($(data).find("#userpictureurl").val()) {
                    $(".get_form_userpicture").html('<img src="'+$(data).find("#userpictureurl").val()+'" height="34" class="rounded" alt="">{% trans 'Change your picture' %}');
                }
            });
            jqxhr.fail(function($xhr) {
                var data = $xhr.status+ " : " +$xhr.statusText;
                showalert("{% trans 'Error during recording.' %} " + "("+data+")<br/>"+"{% trans 'No data could be stored.' %}", "alert-danger");
            });
        });

		</script>

		{% block more_script %}
		{% endblock more_script %}
        <script src="{% static 'feather-icons/feather.min.js' %}"></script>
        <script>
          feather.replace({ class: 'align-bottom'});
        </script>
	</body>
</html>