{% load staticfiles i18n %}

{% if messages %}
    <div id="base-message-alert">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
    {% endfor %}
    </div>
    <script>
        $(document).ready(function () {
            TriggerAlertClose();
        });
    </script>
{% endif %}

<div id="id_notes">
    {% if not listNotes %}
        <p class="noNotes"> {% trans "There is no note for this video. You can create a new one with the three dots menu" %}</p>
    {% endif %}
    {% for note in listNotes %}
    <div id="note-{{ note.id }}" class="status-{{ note.status }}">

        {% include "videos/video_note_display.html" %}

            {% if listComments and note == noteToDisplay or form and note == noteToDisplay %}
                <div id="id_comments">
                    {% for com in listComments %}
                        {% include "videos/video_note_comments_display.html" %}
                    {% endfor %}

                    {% comment %} Form used to create a comment {% endcomment %}
                    {% if form and noteToDisplay and not noteToEdit and not comToEdit %}
                        <form method="post" action="{% url 'video_notes' slug=video.slug %}" class="view_video_notes_com_form hidden">
                            {% csrf_token %}
                            <fieldset>
                                <input type="hidden" id="action_view_{{ note.id }}" name="action" value="get" autocomplete="off"/>
                                <input type="hidden" id="id_view" name="idNote" value="{{ note.id }}" autocomplete="off"/>
                            </fieldset>
                        </form> 
                        <form method="post" action="{% url 'video_notes' slug=video.slug %}" id="video_notes_form">
                        {% csrf_token %}
                            <fieldset>
                                {% if form.errors %} <p class="text-danger">{% trans "One or more errors have been found in the form." %}</p> {% endif %}
                                {% for field_hidden in form.hidden_fields %} {{field_hidden}} {% endfor %}
                                {% for field in form.visible_fields %}
                                    {% spaceless %}
                                    <div class="form-group" >
                                        {{ field.errors }}
                                        {{ field }}
                                        {% if field.help_text %} <small id="{{field.id_for_label}}Help" class="form-text text-muted">{{ field.help_text|safe }}</small> {% endif %}
                                        {% if field.field.required %} <div class="invalid-feedback">{% trans "Please provide a valid value for this field" %}.</div> {% endif %}
                                    </div>
                                    {% endspaceless %}
                                {% endfor %}
                                <input type="hidden" id="id_save" name="idNote" value="{{ note.id }}" autocomplete="off"/>
                                <input type="hidden" id="action" name="action" value="save_com" autocomplete="off"/>
                            </fieldset>
                        </form>
                    {% endif %}

                </div>
            {% endif %}

    </div>
    {% endfor %}

    {% comment %} Form used to create a note {% endcomment %}
    {% if request.user.is_authenticated and form and not noteToDisplay and not noteToEdit and not comToEdit %}
        <form method="post" action="{% url 'video_notes' slug=video.slug %}" class="view_video_notes_form hidden">
            {% csrf_token %}
            <fieldset> <input type="hidden" id="action_view" name="action" value="get" autocomplete="off"/> </fieldset>
        </form> 
        <form method="post" action="{% url 'video_notes' slug=video.slug %}" id="video_notes_form">
        {% csrf_token %}
            <fieldset>
                {% if form.errors %} <p class="text-danger">{% trans "One or more errors have been found in the form." %}</p> {% endif %}
                {% for field_hidden in form.hidden_fields %} {{field_hidden}} {% endfor %}
                {% for field in form.visible_fields %}
                    {% spaceless %}
                    <div class="form-group" >
                        {{ field.errors }}
                        {{ field }}
                        {% if field.help_text %} <small id="{{field.id_for_label}}Help" class="form-text text-muted">{{ field.help_text|safe }}</small> {% endif %}
                        {% if field.field.required %} <div class="invalid-feedback">{% trans "Please provide a valid value for this field" %}.</div> {% endif %}
                    </div>
                    {% endspaceless %}
                {% endfor %}
                <input type="hidden" id="action" name="action" value="save_note" autocomplete="off"/>
            </fieldset>
        </form>
    {% endif %}

</div>
