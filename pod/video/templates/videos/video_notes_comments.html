{% load i18n %}

{% if messages %}
<div id="base-message-alert">
{% for message in messages %}
<div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
  {{ message }}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endfor %}
</div>
<script>
$(document).ready(function () {
    TriggerAlertClose();
});
</script>
{% endif %}

<form method="post" action="{% url 'video_notes' slug=slug %}" id="update_video_notes_form">
{% csrf_token %}
<fieldset>
    <input type="hidden" id="action" name="action" value="update" autocomplete="off"/>
</fieldset>
<button class="update" type="submit" title="{% trans 'Go back to notes' %}"><i data-feather="rotate-ccw"></i></button>
</form>

<form method="post" action="{% url 'video_notes_com' slug=slug id=id %}" id="update_video_notes_com_form">
{% csrf_token %}
<fieldset>
    <input type="hidden" id="action" name="action" value="update" autocomplete="off"/>
</fieldset>
<button class="update" type="submit" title="{% trans 'Update or go back to comments' %}"><i data-feather="refresh-cw"></i></button>
</form>

<div id="id_comments">
    {% for com in listComments %}
    <div id="comment_{{ com.id }}">
        <form method="post" action="{% url 'video_notes_com' slug=slug id=id %}" class="view_video_notes_com_form">
            {% csrf_token %}
            <fieldset>
                <input type="hidden" id="action_view_{{ com.id }}" name="action" value="get" autocomplete="off"/>
                <input type="hidden" id="id_view" name="idcom" value="{{ com.id }}" autocomplete="off"/>
            </fieldset>
            <span class="comment" title="{% trans 'View the comment' %}">{{ com.comstr }}</span>
        </form>

        {% if request.user.is_authenticated and request.user == com.user %}
            <form method="post" action="{% url 'video_notes_com' slug=slug id=id %}" class="edit_video_notes_com_form">
                {% csrf_token %}
                <fieldset>
                    <input type="hidden" id="action_edit_{{ com.id }}" name="action" value="get" autocomplete="off"/>
                    <input type="hidden" id="id_edit" name="idcom" value="{{ com.id }}" autocomplete="off"/>
                </fieldset>
                <button class="edit" type="submit" action="edit" title="{% trans 'Edit the comment' %}"><i data-feather="edit"></i></button>
            </form>

            <form method="post" action="{% url 'video_notes_com' slug=slug id=id %}" class="remove_video_notes_com_form">
                {% csrf_token %}
                <fieldset>
                    <input type="hidden" id="action_rm_{{ com.id }}" name="action" value="remove" autocomplete="off"/>
                    <input type="hidden" id="id_rm" name="idcom" value="{{ com.id }}" autocomplete="off"/>
                </fieldset>
                <button class="remove" type="submit" action="remove" title="{% trans 'Remove the comment' %}"><i data-feather="trash-2"></i></button>
            </form>
        {% endif %}
    </div>
    {% endfor %}
</div>

{% if request.user.is_authenticated %}
<form method="post" action="{% url 'video_notes_com' slug=slug id=id %}" id="video_notes_comments_form">
{% csrf_token %}
<fieldset>
    {% if notesComForm.errors %}
    <p class="text-danger">{% trans "One or more errors have been found in the form." %}</p>
    {% endif %}
    {% for field_hidden in notesComForm.hidden_fields %}
        {{field_hidden}}
    {% endfor %}
    {% for field in notesComForm.visible_fields %}
        {% spaceless %}
        <div class="form-group" >
            {{ field.errors }}
            {{ field }}
            {% if field.help_text %}
            <small id="{{field.id_for_label}}Help" class="form-text text-muted">{{ field.help_text|safe }}</small>
            {% endif %}
            {% if field.field.required %}<div class="invalid-feedback">{% trans "Please provide a valid value for this field" %}.</div>{%endif%}
        </div>
        {% endspaceless %}
    {% endfor %}
    <input type="hidden" id="id_save" name="idcom" autocomplete="off"/>
    <input type="hidden" id="action" name="action" value="save_new" autocomplete="off"/>
</fieldset>
</form>
{% endif %}
