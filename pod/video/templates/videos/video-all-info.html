{% load i18n %}
{% load tagging_tags %}
<h1 class="page_title pt-2 h2">
  {% if video.licence %} {% include "videos/video_licencebox.html" %}{% endif %} {{video.title|capfirst}}
  {% if video.date_evt %}<small>[{{ video.date_evt }}]</small>{% endif %}
  <a href="{% url 'contact_us' %}?video={{video.id}}&subject=inappropriate_content" title="{% trans 'Report the video'%}" >
    <i class="bi bi-exclamation-octagon" aria-hidden="true"></i>
  </a>
</h1>

{% if video.chapter_set.all %}
  <div class="alert alert-info" role="alert">{% blocktrans %}This video is chaptered. Click the chapter button <span class="vjs-icon-chapters"></span> on the video player to view them.{% endblocktrans %}</div>
{%endif%}

<div class="pl-0 pr-0">
  <div class="navbar d-flex flex-row-reverse p-0" >
  <ul class="nav nav-tabs" id="myTab" role="tablist">
    {% tags_for_object video as tag_list %}
    {% if video.description or tag_list or video.is_360 %}
    <li class="nav-item">
      <a class="nav-link active show" id="summary-tab" data-bs-toggle="tab" href="#summary" role="tab" aria-selected="true" title="{% trans 'Summary' %}">
        <i class="bi bi-justify" aria-hidden="true"></i>
      </a>
    </li>
    {% endif %}
    <li class="nav-item">
      <a id="info-tab" data-bs-toggle="tab" href="#info" role="tab" aria-controls="info" title="{% trans 'Infos' %}"
        {% if not video.description and not tag_list and not video.is_360 %}
          class="nav-link active show" aria-selected="true"
        {% else %}
          class="nav-link" aria-selected="false"
        {% endif %}
      ><i class="bi bi-info-circle" aria-hidden="true"></i></a>
    </li>
    {% if video.allow_downloading or video.document_set.all %}
      <li class="nav-item">
        <a class="nav-link" id="downloads-tab" data-bs-toggle="tab" href="#downloads" role="tab" aria-controls="downloads" aria-selected="false" title="{% trans 'Downloads' %}">
          <i class="bi bi-download" aria-hidden="true"></i>
        </a>
      </li>
    {% endif %}
    {% if video.is_draft == False or video.owner == request.user or request.user in video.additional_owners.all %}
      <li class="nav-item">
        <a class="nav-link" id="share-tab" data-bs-toggle="tab" href="#share" role="tab" aria-controls="share" aria-selected="false" title="{% trans 'Embed/Share' %}">
          <i class="bi bi-share" aria-hidden="true"></i>
        </a>
      </li>
    {%endif%}
    {% if third_app %}
    <li class="nav-item dropdown" id="list_third_apps">
      <a  href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  title="{% trans 'Other versions' %}">
        <i class="bi bi-layers" aria-hidden="true"></i>
      </a>
      <div class="dropdown-menu" >
      {% if video.get_hashkey in request.get_full_path %}
        <a href="{% url 'video' slug=video.slug %}{{ video.get_hashkey }}/?redirect=false" title="{% trans 'Original version' %}" class="dropdown-item" target="_blank">{% trans 'Original version' %}</a>
        {% else %}
        <a href="{% url 'video' slug=video.slug %}?redirect=false" title="{% trans 'Original version' %}" class="dropdown-item" target="_blank">{% trans 'Original version' %}</a>
      {% endif %}
      </div>
    </li>
    {% else %}
      {% with video.get_other_version as versions %}
      {% if versions|length > 0 %}
        <li class="nav-item dropdown" id="list_third_apps">
          <a  href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  title="{% trans 'Other versions' %}">
            <i class="bi bi-layers" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu" >
            {% for version in versions %}
              {% if video.get_hashkey in request.get_full_path %}
                <a href="{{version.url}}{{ video.get_hashkey }}/?redirect=false" title="{{version.app}}" class="dropdown-item" >{{version.link}}</a>
              {% else %}
                <a href="{{version.url}}?redirect=false" title="{{version.app}}" class="dropdown-item" >{{version.link}}</a>
              {% endif %}
            {% endfor %}
          </div>
        </li>
      {% endif %}
      {% endwith %}
    {%endif%}

    {% if request.user.playlist_set.all and video.is_draft == False %}
    <li class="nav-item dropdown dropright">
      <a  href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  title="{% trans 'Add the video to a playlist'%}">
        <i class="bi bi-play-circle" aria-hidden="true"></i>
      </a>
      <div class="dropdown-menu">
      {% csrf_token %}
      <ul class="list-group">
      {% for playlist in request.user.playlist_set.all %}
        {% if video in playlist.videos %}
          <li class="dropdown-item py-0" >
            <a href="#" data-slug="{{playlist.slug}}" class="btn disabled p-0 m-0">{{playlist.title}}<i class="bi bi-check2"></i></a>
          </li>
        {% else %}
          <li class="dropdown-item py-0" >
            <a href="#" data-slug="{{playlist.slug}}" class="btn playlist-item p-0 m-0">{{playlist.title}}</a>
          </li>
        {% endif %}
      {% endfor %}
      </ul>
      </div>
    </li>
    {% endif %}
  </ul>
  </div>
  {% include 'videos/video-info.html' %}
</div>
{% if active_video_comment %}
  {% include 'videos/video-comment.html' with is_auth=request.user.is_authenticated disable=video.disable_comment %}
{% endif %}
